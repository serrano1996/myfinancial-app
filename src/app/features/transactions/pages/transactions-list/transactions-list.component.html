<div class="page-container fade-in">
    <header class="page-header">
        <div class="header-content">
            <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600">
                {{ 'TRANSACTIONS.TITLE' | translate }}
            </h1>
            <p class="subtitle">{{ 'TRANSACTIONS.SUBTITLE' | translate }}</p>
        </div>
        <div class="header-actions">
            <button class="btn-glass" (click)="openImportModal()">
                <span class="icon">üì•</span>
                <span>{{ 'TRANSACTIONS.IMPORT_BUTTON' | translate }}</span>
            </button>
            <button class="btn-primary" (click)="openCreateModal()">
                <span class="icon">+</span>
                <span>{{ 'TRANSACTIONS.ADD_BUTTON' | translate }}</span>
            </button>
        </div>
    </header>

    <!-- Main Content Card -->
    <div class="content-card glass-panel fade-in-up">

        <!-- Search and Filter Toggle Bar -->
        <div class="search-bar-container">
            <div class="search-group">
                <span class="search-icon">üîç</span>
                <input type="text" [placeholder]="'TRANSACTIONS.SEARCH_PLACEHOLDER' | translate"
                    [(ngModel)]="searchTerm" (input)="filterTransactionsLocal()">
            </div>

            <button class="btn-icon-toggle" (click)="toggleFilters()" [class.active]="showFilters"
                [title]="'TRANSACTIONS.TOGGLE_FILTERS' | translate">
                <span class="material-icons">filter_list</span>
            </button>
        </div>

        <!-- Filters Section (Collapsible) -->
        <div class="filters-section" *ngIf="showFilters">
            <div class="filter-group">
                <select [(ngModel)]="accountId" (change)="loadTransactions()" class="custom-select w-full">
                    <option value="">{{ 'TRANSACTIONS.FILTER_ACCOUNTS' | translate }}</option>
                    <option *ngFor="let acc of accounts" [value]="acc.id">{{ acc.icon }} {{ acc.name }}</option>
                </select>
            </div>

            <div class="filter-group">
                <select [(ngModel)]="categoryId" (change)="loadTransactions()" class="custom-select w-full">
                    <option value="">{{ 'TRANSACTIONS.FILTER_CATEGORIES' | translate }}</option>
                    <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.icon }} {{ cat.name }}</option>
                </select>
            </div>

            <div class="filter-group date-group">
                <input type="date" [(ngModel)]="startDate" (change)="loadTransactions()" class="custom-date">
                <span class="separator">‚Üí</span>
                <input type="date" [(ngModel)]="endDate" (change)="loadTransactions()" class="custom-date">
            </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-state">
            <div class="spinner"></div>
            <p>{{ 'COMMON.LOADING' | translate }}</p>
        </div>

        <!-- Transactions List -->
        <div *ngIf="!loading" class="transactions-container">
            <div *ngIf="filteredTransactions.length === 0" class="empty-state">
                <div class="empty-icon">üí∏</div>
                <h3>{{ 'TRANSACTIONS.EMPTY' | translate }}</h3>
                <p>{{ 'TRANSACTIONS.EMPTY_SUBTITLE' | translate }}</p>
            </div>

            <div class="transaction-list">
                <div *ngFor="let tx of filteredTransactions; let i = index" class="tx-item" (click)="openEditModal(tx)"
                    [style.animation-delay]="i * 0.05 + 's'">

                    <div class="tx-left">
                        <div class="tx-date-badge">
                            <span class="day">{{ tx.date | date:'dd' }}</span>
                            <span class="month">{{ tx.date | date:'MMM' }}</span>
                        </div>

                        <div class="tx-icon-wrapper"
                            [style.background-color]="(tx.categories?.color || '#64748b') + '20'">
                            <span class="tx-icon" [style.color]="tx.categories?.color || '#64748b'">
                                {{ tx.categories?.icon || 'üìÑ' }}
                            </span>
                        </div>

                        <div class="tx-details">
                            <h3 class="tx-category">{{ tx.categories?.name || 'Uncategorized' }}</h3>
                            <p class="tx-account">{{ tx.accounts?.name }}</p>
                            <p *ngIf="tx.description" class="tx-desc">{{ tx.description }}</p>
                        </div>
                    </div>

                    <div class="tx-right">
                        <div class="amount-wrapper">
                            <span class="amount" [class.income]="tx.categories?.type === 'income'"
                                [class.expense]="tx.categories?.type === 'expense' || tx.categories?.type === 'transfer'">
                                {{ tx.categories?.type === 'expense' || tx.categories?.type === 'transfer' ? '-' : '+'
                                }}
                                {{ tx.amount | currency:'EUR' }}
                            </span>
                        </div>

                        <div class="actions">
                            <button class="action-btn delete" (click)="deleteTransaction(tx.id, $event)"
                                [title]="'COMMON.DELETE' | translate">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-transaction-form-modal [visible]="showModal" [transaction]="editingTransaction" [accounts]="accounts"
        [categories]="categories" [loading]="modalLoading" (save)="handleSave($event)"
        (cancel)="closeModal()"></app-transaction-form-modal>

    <app-csv-import-modal [visible]="showImportModal" (cancel)="closeImportModal()"
        (import)="handleImport($event)"></app-csv-import-modal>
</div>